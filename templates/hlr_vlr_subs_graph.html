<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HLR/VLR Subbase Line Graph</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        #hlr-vlr-subs-chart { width: 90vw; height: 70vh; margin: 0 auto; }
        body { font-family: Arial, sans-serif; background: #f8f8f8; }
        .chart-controls { margin: 20px; }
    </style>
</head>
<body>
    <div class="chart-controls">
        <button onclick="downloadImage()">Download Chart as PNG</button>
    </div>
    <div id="hlr-vlr-subs-chart"></div>
    <script>
    async function fetchData() {
        const resp = await fetch('/hlr-vlr-subbase-data');
        return await resp.json();
    }

    function renderChart(data) {
        const traces = [];
        for (const col of data.y_cols) {
            traces.push({
                x: data.x,
                y: data.y_series[col],
                type: 'scatter',
                mode: 'lines+markers',
                name: col,
                line: { width: 2 },
                marker: { size: 6 }
            });
        }
        const layout = {
            title: 'HLR/VLR Daily Subscribers',
            xaxis: { title: data.x_col, tickangle: 45, tickfont: { size: 10 } },
            yaxis: { title: 'Subscriber Count', tickformat: '.0f' },
            margin: { l: 60, r: 40, t: 80, b: 80 },
            plot_bgcolor: '#fff',
            paper_bgcolor: '#fff'
        };
        Plotly.newPlot('hlr-vlr-subs-chart', traces, layout);
        window.hlrVlrSubsChart = document.getElementById('hlr-vlr-subs-chart');
    }

    function downloadImage() {
        Plotly.downloadImage(window.hlrVlrSubsChart, {
            format: 'png',
            filename: 'hlr_vlr_subs_chart',
            width: 1200,
            height: 800
        });
    }

    fetchData().then(data => {
        if (data.error) {
            document.getElementById('hlr-vlr-subs-chart').innerHTML = '<b style="color:red">' + data.error + '</b>';
        } else {
            renderChart(data);
        }
    });
    </script>
</body>
</html>